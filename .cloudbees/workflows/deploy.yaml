apiVersion: automation.cloudbees.io/v1alpha1
kind: workflow
name: deploy

on: 
  workflow_dispatch: {}
  workflow_call:
    secrets:
      deploy_pwd:
        description: The password to use for deploying
        required: true

jobs:
  prod-auth:
    steps:
      - uses: docker://alpine:3.20
        run: |
          if [ "${{secrets.deploy_pwd}}" != "" ]; then
            echo "authenticated"
          else 
            echo "deploy_pwd is empty"
            exit 1
          fi
  
  scan:
    uses: p-gombola/shared/.cloudbees/workflows/scan.yaml@v1

  prod:
    needs: [scan, prod-auth]
    steps:
      - uses: docker://alpine:3.20
        run: |
          echo "deploying prod..."
  
  staging:
    needs: [scan]
    steps:
      - uses: docker://alpine:3.20
        run: |
          echo "deploying staging..."
